<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/favicon-large.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.png?v=5.1.4">


  <link rel="mask-icon" href="/favicon.png?v=5.1.4" color="#222">





  <meta name="keywords" content="机器学习,Kaggle,麻省理工学院,维基百科,数学," />





  <link rel="alternate" href="/atom.xml" title="纸飞机" type="application/atom+xml" />






<meta name="description" content="挪威科技大学 Didrik Nielsen 的硕士论文《使用 XGBoost 的树提升：为什么 XGBoost 能赢得「每一场」机器学习竞赛？（Tree Boosting With XGBoost - Why Does XGBoost Win “Every” Machine Learning Competition?）》研究分析了 XGBoost 与传统 MART 的不同之处以及在机器学习竞赛上">
<meta name="keywords" content="机器学习,Kaggle,麻省理工学院,维基百科,数学">
<meta property="og:type" content="article">
<meta property="og:title" content="为什么XGBoost在机器学习竞赛中表现如此卓越？">
<meta property="og:url" content="http://blockshare.top/2017/e18ce50b/index.html">
<meta property="og:site_name" content="纸飞机">
<meta property="og:description" content="挪威科技大学 Didrik Nielsen 的硕士论文《使用 XGBoost 的树提升：为什么 XGBoost 能赢得「每一场」机器学习竞赛？（Tree Boosting With XGBoost - Why Does XGBoost Win “Every” Machine Learning Competition?）》研究分析了 XGBoost 与传统 MART 的不同之处以及在机器学习竞赛上">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://p1.pstatp.com/large/4381000187026ba53647">
<meta property="og:updated_time" content="2018-04-23T20:46:37.774Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="为什么XGBoost在机器学习竞赛中表现如此卓越？">
<meta name="twitter:description" content="挪威科技大学 Didrik Nielsen 的硕士论文《使用 XGBoost 的树提升：为什么 XGBoost 能赢得「每一场」机器学习竞赛？（Tree Boosting With XGBoost - Why Does XGBoost Win “Every” Machine Learning Competition?）》研究分析了 XGBoost 与传统 MART 的不同之处以及在机器学习竞赛上">
<meta name="twitter:image" content="http://p1.pstatp.com/large/4381000187026ba53647">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blockshare.top/2017/e18ce50b/"/>





  <title>为什么XGBoost在机器学习竞赛中表现如此卓越？ | 纸飞机</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?11e1fcf8c087695ab66673652234e853";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">纸飞机</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">您的云收藏知识库！</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blockshare.top/2017/e18ce50b/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhifeiji">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="纸飞机">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">为什么XGBoost在机器学习竞赛中表现如此卓越？</h1>
        

        <div class="post-meta">
          <span class="post-time">

            
                <span class="post-meta-item-text">机器之心</span>
            

            
              <span class="post-meta-divider">|</span>
            
          </span>

          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-13T15:28:15+08:00">
                2017-11-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/科学/" itemprop="url" rel="index">
                    <span itemprop="name">科学</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2017/e18ce50b/#SOHUCS" itemprop="discussionUrl">
                  <span id="changyan_count_unit" class="post-comments-count hc-comment-count" data-xid="2017/e18ce50b/" itemprop="commentsCount"></span>
                </a>
              
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-eye"></i></span>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="http://p1.pstatp.com/large/4381000187026ba53647" rel="gallery_cjgf0wkt200eoxmqdqwy7tiws"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="http://p1.pstatp.com/large/4381000187026ba53647" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        <blockquote>
<p>挪威科技大学 Didrik Nielsen 的硕士论文《使用 XGBoost 的树提升：为什么 XGBoost 能赢得「每一场」机器学习竞赛？（Tree Boosting With XGBoost - Why Does XGBoost Win “Every” Machine Learning Competition?）》研究分析了 XGBoost 与传统 MART 的不同之处以及在机器学习竞赛上的优势。机器之心技术分析师对这篇长达 110 页的论文进行了解读，提炼出了其中的要点和核心思想，汇成此篇。本文原文发表在机器之心英文官网上。</p>
<ul>
<li>论文原文：https&#58;//brage.bibsys.no/xmlui/bitstream/handle/11250/2433761/16128_FULLTEXT.pdf- 解读文章英文原文：https&#58;//syncedreview.com/2017/10/22/tree-boosting-with-xgboost-why-does-xgboost-win-every-machine-learning-competition/<br>解读文章英文原文：https&#58;//syncedreview.com/2017/10/22/tree-boosting-with-xgboost-why-does-xgboost-win-every-machine-learning-competition/</li>
</ul>
</blockquote>
<p><strong>引言</strong></p>
<p>tree boosting（树提升）已经在实践中证明可以有效地用于分类和回归任务的预测挖掘。</p>
<p>之前很多年来，人们所选择的树提升算法一直都是 MART（multiple additive regression tree/多重累加回归树）。但从 2015 年开始，一种新的且总是获胜的算法浮出了水面：XGBoost。这种算法重新实现了树提升，并在 Kaggle 和其它数据科学竞赛中屡获佳绩，因此受到了人们的欢迎。</p>
<p>在《Tree Boosting With XGBoost - Why Does XGBoost Win “Every” Machine Learning Competition?》这篇论文中，来自挪威科技大学的 Didrik Nielsen 研究调查了：</p>
<ol>
<li>XGBoost 与传统 MART 的不同之处1. XGBoost 能赢得「每一场」机器学习竞赛的原因<br>XGBoost 能赢得「每一场」机器学习竞赛的原因</li>
</ol>
<p>这篇论文分成三大部分：</p>
<ol>
<li>回顾统计学习的一些核心概念1. 介绍 boosting 并以函数空间中数值优化的方式对其进行解释；进一步讨论更多树方法以及树提升方法的核心元素1. 比较 MART 和 XGBoost 所实现的树提升算法的性质；解释 XGBoost 受欢迎的原因<br>介绍 boosting 并以函数空间中数值优化的方式对其进行解释；进一步讨论更多树方法以及树提升方法的核心元素</li>
</ol>
<p><strong>统计学习的基本概念</strong></p>
<p>这篇论文首先介绍了监督学习任务并讨论了模型选择技术。</p>
<p>机器学习算法的目标是减少预期的泛化误差，这也被称为风险（risk）。如果我们知道真实的分布 P(x,y)，那么风险的最小化就是一个可以通过优化算法解决的最优化任务。但是，我们并不知道真实分布，只是有一个用于训练的样本集而已。我们需要将其转换成一个优化问题，即最小化在训练集上的预期误差。因此，由训练集所定义的经验分布会替代真实分布。上述观点可以表示成下面的统计学公式：</p>
<p><img src="http&#58;//p1.pstatp.com/large/4381000187026ba53647" img_width="247" img_height="72" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>其中 </p>
<p><img src="http&#58;//p3.pstatp.com/large/438000019353332963e4" img_width="58" img_height="43" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p> 是模型的真实风险 R(f) 的经验估计。L(.) 是一个损失函数，比如平方误差损失函数（这是回归任务常用的损失函数），其它损失函数可以在这里找到：http&#58;//<a href="http://www.cs.cornell.edu/courses/cs4780/2017sp/lectures/lecturenote10.html。n" target="_blank" rel="noopener">www.cs.cornell.edu/courses/cs4780/2017sp/lectures/lecturenote10.html。n</a> 是样本的数量。</p>
<p>当 n 足够大时，我们有：</p>
<p><img src="http&#58;//p3.pstatp.com/large/437f00019a8a53262ae4" img_width="241" img_height="69" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>ERM（经验风险最小化）是一种依赖于经验风险的最小化的归纳原理（Vapnik, 1999）。经验风险最小化运算 f hat 是目标函数的经验近似，定义为：</p>
<p><img src="http&#58;//p3.pstatp.com/large/437c0001c366710f5066" img_width="249" img_height="74" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>其中 F 属于某个函数类，并被称为某个模型类（model class），比如常数、线性方法、局部回归方法（k-最近邻、核回归）、样条函数等。ERM 是从函数集 F 中选择最优函数 f hat 的标准。</p>
<p>这个模型类和 ERM 原理可以将学习问题转变成优化问题。模型类可以被看作是候选的解决方案函数，而 ERM 则为我们提供了选择最小化函数的标准。</p>
<p>针对优化问题的方法有很多，其中两种主要方法是梯度下降法和牛顿法；MART 和 XGBoost 分别使用了这两种方法。</p>
<p>这篇论文也总结了常见的学习方法：</p>
<ol>
<li><p>常数</p>
</li>
<li><p>线性方法</p>
</li>
<li><p>局部最优方法</p>
</li>
<li><p>基函数扩展：显式非线性项、样条、核方法等</p>
</li>
<li><p>自适应基函数模型：GAM（广义相加模型）、神经网络、树模型、boosting</p>
</li>
</ol>
<p>另一个机器学习概念是模型选择（model selection），这要考虑不同的学习方法和它们的超参数。首要的问题一直都是：增加模型的复杂度是否更好？而答案也总是与模型自身的泛化性能有关。如下图 1 所示，我们也许可以在模型更加复杂的同时得到更好的表现（避免欠拟合），但我们也会失去泛化性能（过拟合）：</p>
<p><img src="http&#58;//p9.pstatp.com/large/4382000169e75fda608b" img_width="607" img_height="476" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>图 1：泛化性能 vs 训练误差</p>
<p>为平方损失使用预期条件风险的经典的偏置-方差分解（bias-variance decomposition），我们可以观察风险相对于复杂度的变化：</p>
<p><img src="http&#58;//p9.pstatp.com/large/438100018703db359a5c" img_width="618" img_height="463" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>图 2：预期风险 vs 方差 vs 偏置</p>
<p>为此通常使用的一种技术是正则化（regularization）。通过隐式和显式地考虑数据的拟合性和不完善性，正则化这种技术可以控制拟合的方差。它也有助于模型具备更好的泛化性能。</p>
<p>不同的模型类测量复杂度的方法也不一样。LASSO 和 Ridge（Tikhonov regularization）是两种常用于线性回归的测量方法。我们可以将约束（子集化、步进）或惩罚（LASSO、Ridge）直接应用于复杂度测量。</p>
<p><strong>理解 Boosting、树方法和树提升</strong></p>
<p><strong>Boosting</strong></p>
<p>boosting 是一种使用多个更简单的模型来拟合数据的学习算法，它所用的这些更简单的模型也被称为基本学习器（base learner）或弱学习器（weak learner）。其学习的方法是使用参数设置一样或稍有不同的基本学习器来自适应地拟合数据。</p>
<p>Freund 和 Schapire (1996) 带来了第一个发展：AdaBoost。实际上 AdaBoost 是最小化指数损失函数，并迭代式地在加权的数据上训练弱学习器。研究者也提出过最小化对数损失的二阶近似的新型 boosting 算法：LogitBoost。</p>
<p>Breiman (1997a,b 1998) 最早提出可以将 boosting 算法用作函数空间中的数值优化技术。这个想法使得 boosting 技术也可被用于回归问题。这篇论文讨论了两种主要的数值优化方法：梯度提升和牛顿提升（也被称为二阶梯度提升或 Hessian boosting，因为其中应用了 Hessian 矩阵）。下面，让我们一步一步了解 boosting 算法。</p>
<p>boosting 拟合同一类的集成模型（ensemble model）：</p>
<p><img src="http&#58;//p1.pstatp.com/large/438000019355a2802660" img_width="182" img_height="81" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>其可以被写成自适应基函数模型：</p>
<p><img src="http&#58;//p3.pstatp.com/large/4382000169e926c52d13" img_width="250" img_height="72" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>其中 f_0(x)=θ_0 且 f_m(x)=θ_m*Φ_m(x)，m=1,…,M，Φm 是按顺序累加的基本函数，可用于提升当前模型的拟合度。</p>
<p>因此，大多数 boosting 算法都可以看作是在每次迭代时或准确或近似地求解</p>
<p><img src="http&#58;//p3.pstatp.com/large/438300001cbea619859f" img_width="611" img_height="79" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>所以，AdaBoost 就是为指数损失函数求解上述等式，其约束条件为：Φm 是 A=&amp;#123-1,1&amp;#125 的分类器。而梯度提升或牛顿提升则是为任意合适的损失函数近似求解上述等式。</p>
<p>梯度提升和牛顿提升的算法如下：</p>
<p><img src="http&#58;//p3.pstatp.com/large/438300001cc0f72550f2" img_width="640" img_height="518" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p><img src="http&#58;//p3.pstatp.com/large/438300001cc1e75c4f0b" img_width="630" img_height="509" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p><img src="http&#58;//p3.pstatp.com/large/437c0001c367bb49777f" img_width="78" img_height="33" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<ul>
<li>是梯度<br><img src="http&#58;//p9.pstatp.com/large/4382000169ec2d50f9df" img_width="37" img_height="39" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></li>
<li>是使用数据学习到的弱学习器<br><img src="http&#58;//p1.pstatp.com/large/438000019356e0b1fe3d" img_width="82" img_height="40" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></li>
<li>是经验 Hessian- 梯度提升：<br>梯度提升：</li>
</ul>
<p><img src="http&#58;//p3.pstatp.com/large/4382000169eba240effb" img_width="37" img_height="27" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<ul>
<li>是由线搜索（line search）确定的步长- 牛顿提升：<br>牛顿提升：</li>
</ul>
<p>最常用的基本学习器是回归树（比如 CART），以及分量形式的线性模型（component-wise linear model）或分量形式的平滑样条（component-wise smoothing spline）。基本学习器的原则是要简单，即有很高的偏置，但方差很低。</p>
<p>boosting 方法中的超参数有：</p>
<ol>
<li>迭代次数 M：M 越大，过拟合的可能性就越大，因此需要验证集或交叉验证集。1. 学习率 η ：降低学习率往往会改善泛化性能，但同时也会让 M 增大，如下图所示。<br>学习率 η ：降低学习率往往会改善泛化性能，但同时也会让 M 增大，如下图所示。</li>
</ol>
<p><img src="http&#58;//p3.pstatp.com/large/4380000193586bd42af6" img_width="537" img_height="367" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>在 Boston Housing 数据集上的不同学习率的样本外（out-of-sample）RMSE</p>
<p><strong>树方法</strong></p>
<p>树模型是简单和可解释的模型。它们的预测能力确实有限，但将多个树模型组合到一起（比如 bagged trees、随机森林或在 boosting 中），它们就可以变成一种强大的预测模型。</p>
<p>我们可以将树模型看作是将特征空间分割成几个不同的矩形和非重叠区域集合，然后它可以拟合一些简单的模型。下图给出了使用 Boston Housing 数据得到的可视化结果：</p>
<p><img src="http&#58;//p9.pstatp.com/large/437e0003f30d9cdc5b06" img_width="398" img_height="375" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>终端节点的数量和树的深度可以看作是树模型的复杂度度量。为了泛化这种模型，我们可以在复杂度度量上轻松地应用一个复杂度限制，或在终端节点的数量或叶权重的惩罚项上应用一个惩罚（XGBoost 使用的这种方法）。</p>
<p>因为学习这种树的结构是 NP 不完全的，所以学习算法往往会计算出一个近似的解。这方面有很多不同的学习算法，比如 CART（分类和回归树）、C4.5 和 CHAID。这篇论文描述了 CART，因为 MART 使用的 CART，XGBoost 也实现了一种与 CART 相关的树模型。</p>
<p>CART 以一种自上而下的方式生长树。通过考虑平行于坐标轴的每次分割，CART 可以选择最小化目标的分割。在第二步中，CART 会考虑每个区域内每次平行的分割。在这次迭代结束时，最好的分割会选出。CART 会重复所有这些步骤，直到达到停止标准。</p>
<p>给定一个区域 Rj，学习其权重 wj 通常很简单。令 Ij 表示属于区域 Rj 的索引的集合，即 xi∈Rj，其中 i∈Ij。</p>
<p>其权重是这样估计的：</p>
<p><img src="http&#58;//p1.pstatp.com/large/437c0001c36a818abb1d" img_width="295" img_height="70" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>对于一个树模型 f_hat，经验风险为：</p>
<p><img src="http&#58;//p3.pstatp.com/large/43810001870751cb4bb9" img_width="385" img_height="110" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>其中我们令 L_j hat 表示节点 j 处的累积损失。在学习过程中，当前树模型用 f_before hat 和 f_after hat 表示。</p>
<p>我们可以计算所考虑的分割所带来的增益：</p>
<p><img src="http&#58;//p3.pstatp.com/large/4381000187064092e465" img_width="544" img_height="47" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>对于每一次分割，每个可能节点的每个可能分割都会计算这种增益，再取其中最大的增益。</p>
<p>现在让我们看看缺失值。CART 会使用替代变量（surrogate variable）来处理缺失值，即对于每个预测器，我们仅使用非缺失数据来寻找分割，然后再基于主分割寻找替代预测因子，从而模拟该分割。比如，假设在给定的模型中，CART 根据家庭收入分割数据。如果一个收入值不可用，那么 CART 可能会选择教育水平作为很好的替代。</p>
<p>但 XGBoost 是通过学习默认方向来处理缺失值。XGBoost 会在内部自动学习当某个值缺失时，最好的方向是什么。这可以被等价地看作是根据训练损失的减少量而自动「学习」缺失值的最佳插补值。</p>
<p>根据类别预测器，我们可以以两种方式处理它们：分组类别或独立类别。CART 处理的是分组类别，而 XGBoost 需要独立类别（one-hot 编码）。</p>
<p>这篇论文以列表的形式总结了树模型的优缺点：</p>
<p>优点（Hastie et al., 2009; Murphy, 2012）：</p>
<p>•容易解释</p>
<p>•可以相对快地构建</p>
<p>•可以自然地处理连续和分类数据</p>
<p>•可以自然地处理缺失数据</p>
<p>•对输入中的异常值是稳健的</p>
<p>•在输入单调变换时是不变的</p>
<p>•会执行隐式的变量选择</p>
<p>•可以得到数据中的非线性关系</p>
<p>•可以得到输入之间的高阶交互</p>
<p>•能很好地扩展到大型数据集</p>
<p>缺点（Hastie et al., 2009; Kuhn and Johnson, 2013; Wei-Yin Loh, 1997; Strobl et al., 2006）：</p>
<p>•往往会选择具有更高数量的不同值的预测器</p>
<p>•当预测器具有很多类别时，可能会过拟合</p>
<p>•不稳定，有很好的方差</p>
<p>•缺乏平滑</p>
<p>•难以获取叠加结构</p>
<p>•预测性能往往有限</p>
<p><strong>树提升</strong></p>
<p>在上述发展的基础上，现在我们将 boosting 算法与基本学习器树方法结合起来。</p>
<p>提升后的树模型可以看作是自适应基函数模型，其中的基函数是回归树：</p>
<p><img src="http&#58;//p3.pstatp.com/large/437e0003f30fa815ceb0" img_width="329" img_height="287" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>提升树模型（boosting tree model）是多个树 fm 的和，所以也被称为树集成（tree ensemble）或叠加树模型（additive tree model）。因此它比单个树模型更加平滑，如下图所示：</p>
<p><img src="http&#58;//p9.pstatp.com/large/43800001935b861a81ef" img_width="519" img_height="506" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>拟合 Boston Housing 数据的叠加树模型的可视化</p>
<p>在提升树模型上实现正则化的方法有很多：</p>
<ol>
<li><p>在基函数扩展上进行正则化</p>
</li>
<li><p>在各个树模型上进行正则化</p>
</li>
<li><p>随机化</p>
</li>
</ol>
<p>一般来说，提升树往往使用很浅的回归树，即仅有少数终端节点的回归树。相对于更深度的树，这样的方差较低，但偏置更高。这可以通过应用复杂度约束来完成。</p>
<p>XGBoost 相对于 MART 的优势之一是复杂度的惩罚，这对叠加树模型而言并不常见。目标函数的惩罚项可以写成：</p>
<p><img src="http&#58;//p1.pstatp.com/large/437c0001c36b5b19a714" img_width="497" img_height="87" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>其中第一项是每个单个树的终端节点的数量，第二项是在该项权重上的 L2 正则化，最后一项是在该项权重上的 L1 正则化。</p>
<p>Friedman(2002) 最早引入了随机化，这是通过随机梯度下降实现的，其中包括在每次迭代时进行行子采样（row subsampling）。随机化有助于提升泛化性能。子采样的方法有两种：行子采样与列子采样（column subsampling）。MART 仅包含行子采样（没有替代），而 XGBoost 包含了行子采样和列子采样两种。</p>
<p>正如前面讨论的那样，MART 和 XGBoost 使用了两种不同的 boosting 算法来拟合叠加树模型，分别被称为 GTB（梯度树提升）和 NTB（牛顿树提升）。这两种算法都是要在每一次迭代 m 最小化：</p>
<p><img src="http&#58;//p3.pstatp.com/large/437e0003f310df47cb00" img_width="382" img_height="65" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>其基函数是树：</p>
<p><img src="http&#58;//p3.pstatp.com/large/438100018708ccc9da93" img_width="358" img_height="91" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>其一般步骤包含 3 个阶段：</p>
<ol>
<li><p>确定一个固定的候选树结构的叶权重 ；</p>
</li>
<li><p>使用前一阶段确定的权重，提出不同的树结构，由此确定树结构和区域；</p>
</li>
<li><p>一旦树结构确定，每个终端节点中的最终叶权重（其中 j=1,..,T）也就确定了。</p>
</li>
</ol>
<p>算法 3 和 4 使用树作为基函数，对算法 1 和 2 进行了扩展：</p>
<p><img src="http&#58;//p3.pstatp.com/large/43800001935dc2c11af6" img_width="639" img_height="604" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p><img src="http&#58;//p1.pstatp.com/large/437c0001c36c125bce5c" img_width="632" img_height="555" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p><strong>XGBoost 和 MART 的差异</strong></p>
<p>最后，论文对两种树提升算法的细节进行了比较，并试图给出 XGBoost 更好的原因。</p>
<p><strong>算法层面的比较</strong></p>
<p>正如之前的章节所讨论的那样，XGBoost 和 MART 都是要通过简化的 FSAM（Forward Stage Additive Modelling/前向阶段叠加建模）求解同样的经验风险最小化问题：</p>
<p><img src="http&#58;//p3.pstatp.com/large/4382000169f0c28ea666" img_width="578" img_height="62" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>即不使用贪婪搜索，而是每次添加一个树。在第 m 次迭代时，使用下式学习新的树：</p>
<p><img src="http&#58;//p1.pstatp.com/large/438300001cc83a3a15f1" img_width="614" img_height="65" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>XGBoost 使用了上面的算法 3，即用牛顿树提升来近似这个优化问题。而 MART 使用了上面的算法 4，即用梯度树提升来做这件事。这两种方法的不同之处首先在于它们学习树结构的方式，然后还有它们学习分配给所学习的树结构的终端节点的叶权重的方式。</p>
<p>再看看这些算法，我们可以发现牛顿树提升有 Hessian 矩阵，其在确定树结构方面发挥了关键性的作用，XGBoost：</p>
<p><img src="http&#58;//p3.pstatp.com/large/43810001870cb44787ff" img_width="344" img_height="83" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>而使用了梯度树提升的 MART 则是：</p>
<p><img src="http&#58;//p3.pstatp.com/large/438300001cc92871914a" img_width="275" img_height="62" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>然后，XGBoost 可以直接这样定义牛顿树提升的叶权重：</p>
<p><img src="http&#58;//p9.pstatp.com/large/4382000169f18bdf3bd4" img_width="167" img_height="70" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>使用梯度树提升的 MART 则这样定义：</p>
<p><img src="http&#58;//p1.pstatp.com/large/437c0001c36d3e130ca9" img_width="504" img_height="72" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>总结一下，XGBoost 使用的 Hessian 是一种更高阶的近似，可以学习到更好的树结构。但是，MART 在确定叶权重上表现更好，但却是对准确度更低的树结构而言。</p>
<p>在损失函数的应用性方面，牛顿树提升因为要使用 Hessian 矩阵，所以要求损失函数是二次可微的。所以它在选择损失函数上要求更加严格，必须要是凸的。</p>
<p>当 Hessian 每一处都等于 1 时，这两种方法就是等价的，这就是平方误差损失函数的情况。因此，如果我们使用平方误差损失函数之外的任何损失函数，在牛顿树提升的帮助下，XGBoost 应该能更好地学习树结构。只是梯度树提升在后续的叶权重上更加准确。因此无法在数学上对它们进行比较。</p>
<p>尽管如此，该论文的作者在两个标准数据集上对它们进行了测试：Sonar 和 Ionosphere（Lichman, 2013）。这个实证比较使用了带有 2 个终端节点的树，没有使用其它正则化，而且这些数据也没有分类特征和缺失值。梯度树提升还加入了一个线搜索（line search），如图中红色线所示。</p>
<p><img src="http&#58;//p3.pstatp.com/large/4382000169f3d8d4222c" img_width="560" img_height="238" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>这个比较图说明这两种方法都能无缝地执行。而且线搜索确实能提升梯度提升树的收敛速度。</p>
<p><strong>正则化比较</strong></p>
<p>正则化参数实际上有 3 类：</p>
<p>1.boosting 参数：树的数量 M 和学习率η</p>
<ol start="2">
<li><p>树参数：在单个树的复杂度上的约束和惩罚</p>
</li>
<li><p>随机化参数：行子采样和列子采样</p>
</li>
</ol>
<p>两种 boosting 方法的主要差别集中在树参数以及随机化参数上。</p>
<p>对于树参数，MART 中的每个树都有同样数量的终端节点，但 XGBoost 可能还会包含终端节点惩罚 γ，因此其终端节点的数量可能会不一样并且在最大终端节点数量的范围内。XGBoost 也在叶权重上实现了 L2 正则化，并且还将在叶权重上实现 L1 正则化。</p>
<p>在随机化参数方面，XGBoost 提供了列子采样和行子采样；而 MART 只提供了行子采样。</p>
<p><strong>为什么 XGBoost 能赢得「每一场」竞赛？</strong></p>
<p>通过使用模拟数据，论文作者首次表明树提升可以被看作是自适应地确定局部邻域。</p>
<p>使用</p>
<p><img src="http&#58;//p3.pstatp.com/large/437f00019a921452dea7" img_width="572" img_height="300" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>生成</p>
<p><img src="http&#58;//p9.pstatp.com/large/43800001935f36551784" img_width="624" img_height="484" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>然后使用局部线性回归（使用了两种不同灵活度的拟合）来拟合它：</p>
<p><img src="http&#58;//p3.pstatp.com/large/43810001870ecdc70bc7" img_width="539" img_height="251" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>然后使用平滑样条函数（使用了两种不同灵活度的拟合）来拟合它：</p>
<p><img src="http&#58;//p1.pstatp.com/large/43810001870fd93b188f" img_width="575" img_height="255" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>现在我们尝试提升的树桩（boosted tree stump）（两个终端节点）拟合：</p>
<p><img src="http&#58;//p3.pstatp.com/large/437f00019a9305abc0eb" img_width="426" img_height="317" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>本论文详细说明了权重函数影响拟合的确定的方式，并且表明树提升可以被看作是直接在拟合阶段考虑偏置-方差权衡。这有助于邻域保持尽可能大，以避免方差不必要地增大，而且只有在复杂结构很显然的时候才会变小。</p>
<p>尽管当涉及到高维问题时，树提升「打败了」维度的诅咒（curse of dimensionality），而没有依赖任何距离指标。另外，数据点之间的相似性也可以通过邻域的自适应调整而从数据中学习到。这能使模型免疫维度的诅咒。</p>
<p>另外更深度的树也有助于获取特征的交互。因此无需搜索合适的变换。</p>
<p>因此，是提升树模型（即自适应的确定邻域）的帮助下，MART 和 XGBoost 一般可以比其它方法实现更好的拟合。它们可以执行自动特征选择并且获取高阶交互，而不会出现崩溃。</p>
<p>通过比较 MART 和 XGBoost，尽管 MART 确实为所有树都设置了相同数量的终端节点，但 XGBoost 设置了 Tmax 和一个正则化参数使树更深了，同时仍然让方差保持很低。相比于 MART 的梯度提升，XGBoost 所使用的牛顿提升很有可能能够学习到更好的结构。XGBoost 还包含一个额外的随机化参数，即列子采样，这有助于进一步降低每个树的相关性。</p>
<p><strong>机器之心分析师的看法</strong></p>
<p>这篇论文从基础开始，后面又进行了详细的解读，可以帮助读者理解提升树方法背后的算法。通过实证和模拟的比较，我们可以更好地理解提升树相比于其它模型的关键优势以及 XGBoost 优于一般 MART 的原因。因此，我们可以说 XGBoost 带来了改善提升树的新方法。</p>
<p>本分析师已经参与过几次 Kaggle 竞赛了，深知大家对 XGBoost 的兴趣以及对于如何调整 XGBoost 的超参数的广泛深度的讨论。相信这篇文章能够启迪和帮助初学者以及中等水平的参赛者更好地详细理解 XGBoost。</p>
<p><img src="http&#58;//p3.pstatp.com/large/4382000169f5e3744f34" img_width="73" img_height="24" alt="为什么XGBoost在机器学习竞赛中表现如此卓越？" inline="0"></p>
<p>参考文献</p>
<ul>
<li>Chen, T. and Guestrin, C. (2016). Xgboost&#58; A scalable tree boosting system. In Proceedings of the 22Nd ACM SIGKDD International Conference on Knowl- edge Discovery and Data Mining, KDD 』16, pages 785–794, New York, NY, USA. ACM.- Freund, Y. and Schapire, R. E. (1996). Experiments with a new boosting algorithm. In Saitta, L., editor, Proceedings of the Thirteenth International Conference on Machine Learning (ICML 1996), pages 148–156. Morgan Kaufmann.- Friedman, J. H. (2002). Stochastic gradient boosting. Comput. Stat. Data Anal., 38(4)&#58;367–378.- Hastie, T., Tibshirani, R., and Friedman, J. (2009). The Elements of Statistical Learning&#58; Data Mining, Inference, and Prediction, Second Edition. Springer Series in Statistics. Springer.- Kuhn, M. and Johnson, K. (2013). Applied Predictive Modeling. SpringerLink &#58; Bu ̈cher. Springer New York.- Lichman, M. (2013). UCI machine learning repository.- Murphy, K. P. (2012). Machine Learning&#58; A Probabilistic Perspective. The MIT Press.- Strobl, C., laure Boulesteix, A., and Augustin, T. (2006). Unbiased split selection for classification trees based on the gini index. Technical report.- Vapnik, V. N. (1999). An overview of statistical learning theory. Trans. Neur. Netw., 10(5)&#58;988–999.- Wei-Yin Loh, Y.-S. S. (1997). Split selection methods for classification trees. Statistica Sinica, 7(4)&#58;815–840.- Wikipedia&#58;&#58;Lasso. https&#58;//en.wikipedia.org/wiki/Lasso_(statistics)- Wikipedia&#58;&#58;Tikhonov regularization. https&#58;//en.wikipedia.org/wiki/Tikhonov_regularization<br>Freund, Y. and Schapire, R. E. (1996). Experiments with a new boosting algorithm. In Saitta, L., editor, Proceedings of the Thirteenth International Conference on Machine Learning (ICML 1996), pages 148–156. Morgan Kaufmann.</li>
</ul>
<p>Hastie, T., Tibshirani, R., and Friedman, J. (2009). The Elements of Statistical Learning&#58; Data Mining, Inference, and Prediction, Second Edition. Springer Series in Statistics. Springer.</p>
<p>Lichman, M. (2013). UCI machine learning repository.</p>
<p>Strobl, C., laure Boulesteix, A., and Augustin, T. (2006). Unbiased split selection for classification trees based on the gini index. Technical report.</p>
<p>Wei-Yin Loh, Y.-S. S. (1997). Split selection methods for classification trees. Statistica Sinica, 7(4)&#58;815–840.</p>
<p>Wikipedia&#58;&#58;Tikhonov regularization. https&#58;//en.wikipedia.org/wiki/Tikhonov_regularization</p>
<blockquote>
<p><strong>转载来源</strong>：<a href="https://m.toutiao.com/i6485929733132386829" target="_blank" rel="noopener">为什么XGBoost在机器学习竞赛中表现如此卓越？</a></p>
</blockquote>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>让纸飞机飞得更快更高：</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>点赞</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/uploads/wechatpay.png" alt="zhifeiji 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/uploads/alipay.jpg" alt="zhifeiji 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/机器学习/" rel="tag"># 机器学习</a>
          
            <a href="/tags/Kaggle/" rel="tag"># Kaggle</a>
          
            <a href="/tags/麻省理工学院/" rel="tag"># 麻省理工学院</a>
          
            <a href="/tags/维基百科/" rel="tag"># 维基百科</a>
          
            <a href="/tags/数学/" rel="tag"># 数学</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/35ef43a6/" rel="next" title="Hinton的Capsule论文全公开！首发《胶囊间的动态路由》原文精译">
                <i class="fa fa-chevron-left"></i> Hinton的Capsule论文全公开！首发《胶囊间的动态路由》原文精译
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/8fb17f0e/" rel="prev" title="谷歌开源「Tangent」：一个用于自动微分的源到源Python库">
                谷歌开源「Tangent」：一个用于自动微分的源到源Python库 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
<span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_fav">收藏夹</a>
<a class="jiathis_button_copy">复制网址</a>
<a class="jiathis_button_email">邮件</a>
<a class="jiathis_button_weixin">微信</a>
<a class="jiathis_button_qzone">QQ空间</a>
<a class="jiathis_button_tqq">腾讯微博</a>
<a class="jiathis_button_douban">豆瓣</a>
<a class="jiathis_button_share">一键分享</a>

<a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
var jiathis_config={
  data_track_clickback:true,
  summary:"",
  shortUrl:false,
  hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script>
<!-- JiaThis Button END -->
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="SOHUCS"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/avatar1.jpg"
                alt="zhifeiji" />
            
              <p class="site-author-name" itemprop="name">zhifeiji</p>
              <p class="site-description motion-element" itemprop="description">纸飞机，您可以随时随地分享链接、图片、文字、视频等，轻轻一掷，我们会帮您做整理、归类，创建属于您的个人空间。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">290</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">320</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="mailto:zymlpear@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">纸飞机</span>

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  




  
    <script type="text/javascript">
    (function(){
      var appid = 'cytz1Qb4z';
      var conf = '058029b4a38c8366d2fd43c54318cba0';
      var width = window.innerWidth || document.documentElement.clientWidth;
      if (width < 960) {
      window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){
        window.changyan.api.config({appid:appid,conf:conf})});
      }
    })();
    </script>
    <script type="text/javascript" src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script>
  









  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
